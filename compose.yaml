services:
  audit-mcp:
    build:
      context: .
      dockerfile: apps/audit-mcp/Dockerfile
    env_file:
      - .env
    ports:
      - 8010:8010
    volumes:
      - audit_data:/data
    healthcheck:
      test:
        - CMD
        - python
        - -c
        - import urllib.request;
          urllib.request.urlopen('http://localhost:8010/health')
      interval: 5s
      timeout: 3s
      retries: 20
  orchestrator:
    build:
      context: .
      dockerfile: apps/orchestrator/Dockerfile
    env_file:
      - .env
    ports:
      - 8000:8000
    depends_on:
      audit-mcp:
        condition: service_healthy
    healthcheck:
      test:
        - CMD
        - python
        - -c
        - import urllib.request;
          urllib.request.urlopen('http://localhost:8000/health')
      interval: 5s
      timeout: 3s
      retries: 20
  risk-mcp:
    build:
      context: .
      dockerfile: apps/risk-mcp/Dockerfile
    ports:
      - 8020:8020
    depends_on:
      audit-mcp:
        condition: service_healthy
    healthcheck:
      test:
        - CMD
        - python
        - -c
        - import urllib.request;
          urllib.request.urlopen('http://localhost:8020/health')
      interval: 5s
      timeout: 3s
      retries: 20
volumes:
  audit_data: null
